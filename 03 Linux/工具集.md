
# 01 压缩

## 1.1 tar

## 1.2 7-zip

7-zip 是一款原本用于 Windows 系统的优秀的开源压缩软件。由于 7-zip 支持的文件格式多，压缩速度及质量好，受到不少人的喜爱。因此在 7-zip 官方提供 Linux 版本之前，就已经有人将 7-zip 移植到 Linux 系统上，并作为软件 `p7zip` 存在，可以直接从各大系统的仓库中下载。

目前 7-zip 已经有了官方的版本，因此我们可以自由选择。

### 1.2.1 Installation

#### 1. Package Manager

```bash
# for Ubuntu/Debian
sudo apt install p7zip
sudo apt install p7zip-full

# for Arch
sudo pacman -S 7-zip
sudo pacman -S 7-zip-full
```

#### 2. From Authority

可以直接从 [官方](https://sparanoid.com/lab/7z/download.html) 下载 Linux 上的可执行程序，然后将其解压缩到想要存放的目录，最后将该目录其添加到环境变量即可。

```bash
sudo mkdir /opt/7z
sudo tar -xf 7z2402-linux-x64.tar.xz -C /opt/7z
```

对于 bash 用户

```bash
echo "export PATH=/opt/7z/:$PATH" >> ~/.bashrc
```


对于 zsh 用户

```bash
echo "export PATH=/opt/7z/:$PATH" >> ~/.zshrc
```

对于 fish 用户

```bash
echo "set PATH /opt/7z $PATH" >> ~/.config/fish/config.fish
```

> 注意，在官方给出的程序中，7z 是使用 `7zz` 和 `7zzs` 两个应用程序完成的，因此命令会稍有不同，但是，我们可以通过设置命令的别名来使用 `7z` 作为我们的命令名。

### 1.2.2 Usage

`7z <command> [<switches>...] <archive_name> [<file_names>...] [@listfile]`

#### 1. 添加文件到压缩格式

使用 `a` 作为 `<command>` ，能够将文件或文件夹添加到目标压缩包中，如果压缩包不存在，则创建压缩包

```bash
7z a <archive_name> <fil/dir_ename>...
# a 为 add，向压缩包中添加没有的文件

7z a test test.sh
# 生成 test.7z 

7z a test.tar test.sh
# 生成 test.tar 

7z a test.zip testshell/
# 生成 test.zip
```

默认的压缩方式为 `7z` ，我们可以通过设置压缩的后缀来设置压缩格式，也可以通过设置 `<switches>` 的 `-t{Type}` 来指定压缩格式 : 

```bash
7z a -tzip test test.sh
# 生成 test.zip
```

> 可以通过 `7z i` 来查看支持的格式

此外，在压缩大文件的时候，我们也可以通过 `-m{Parameters}` 设置压缩的等级和使用的线程数 : 

```bash
7z a -mmt[N] <archive_name> <file/dir>...
# 设置使用的线程数
7z a -mnt[16] test testshell
# 通过16线程压缩

7z a -mx[N] <archive_name> <file/dir>...
# 设置压缩的等级，压缩的等级从 1 ~ 9
# 1 压缩最快，9 压缩程度越高
7z a -mx5 test testshell
# 通过等级 5 来压缩文件
```

和其他的压缩一样，我们还可以为其设置密码 : 

```bash
7z a -p{Password} <archive_name> <file/dir>...

7z a -p1234 test testshell
```

#### 2. 解压缩

```bash
7z e <archive_name>
# 直接解压缩，生成和压缩包一样的文件夹名
# e 为 extarct

7z e test.7z
```

我们也可以指定将压缩包输出至特定文件夹

```bash
7z e -o{DIR} <archive_name>

7z e -otest_extract/ test.7z
```

#### 3. 更新文件

我们还可以将已经在压缩包中的文件更新为我们想要的新版本

```bash
7z u <archive_name> <file/dir>...
# u 为 update

7z u test.7z test.sh
```

#### 4. 测试压缩包

我们可以检查压缩包有没有损坏 : 

```bash
7z t <archive_name>
# t 为 test

7z u test.7z
```